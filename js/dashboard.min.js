!function(){function e(){n("","green"),setTimeout(()=>{a("tipp_account",{}),window.location.replace(chrome.runtime.getURL("splash.html"))},700)}function t(){const e=r("tipp_account");e&&e.stripe?(document.querySelector("#stripe-dashboard-btn a").style.display="block",document.querySelector("#stripe-connect-btn a").style.display="none"):(document.querySelector("#stripe-dashboard-btn a").style.display="none",document.querySelector("#stripe-connect-btn a").style.display="block")}function n(e,t){let n=document.querySelector(".tipp-preloader-modal"),c=n.querySelector(".spinner-layer");switch(document.querySelector(".tipp-preloader-modal .msg").textContent=e,c.classList.remove("spinner-blue-only"),c.classList.remove("spinner-red-only"),c.classList.remove("spinner-green-only"),t){case"blue":c.classList.add("spinner-blue-only");break;case"red":c.classList.add("spinner-red-only");break;case"green":default:c.classList.add("spinner-green-only")}n.style.display="block"}function c(){document.querySelector(".tipp-preloader-modal").style.display="none"}function o(e,t){document.querySelector(t).src=e}function s(e,t){let n=document.createElement("li");n.id+="channel-collection-item";let c=function(e){let t=document.createElement("ul");return t.className+="collection yt-channels ",e.forEach(e=>{let n=function(e,t,n,c){let o=document.createElement("div"),s=document.createElement("img"),a=document.createTextNode(n),r=c?function(e){let t=document.createElement("i"),n=document.createTextNode(e);return t.className+="material-icons ",t.appendChild(n),t}(c):null;return o.className+="chip ",o.className+=e+" ",s.src=t,o.appendChild(s),o.appendChild(a),r&&o.appendChild(r),o}("yt-channel",e.channelIcon,e.channelName,"check");t.appendChild(n)}),t}(e);n.appendChild(c);const o=document.querySelector("#channel-collection-item");o&&o.remove(),$(t).after(n)}function a(e,t){localStorage.setItem(e,JSON.stringify(t))}function r(e){return JSON.parse(localStorage.getItem(e))}M.Sidenav.init(document.querySelector(".side-nav")),M.Modal.init(document.querySelectorAll(".modal")),function(){n("","green");const e=r("tipp_account");$(".user-view .name").text(`${e.fname} ${e.lname}`),$(".user-view .username").text(`@${e.displayname}`),t(),e.channels.length&&(o(e.channels[0].channelIcon,".user-view .profile-pic"),s(e.channels,"#yt-account"));setTimeout(()=>{c(),function(){const e=r("tipp_account");e.channels.length&&e.stripe||M.toast({html:'<span>1) Add a YouTube channel.</span><i class="material-icons right white-text dismiss-toast">close</i>',classes:"red white-text",displayLength:5e3,outDuration:300,completeCallback:()=>{M.toast({html:'<span>2) Connect a Stripe account.</span><i class="material-icons right white-text dismiss-toast">close</i>',classes:"blue white-text",displayLength:5e3,outDuration:300,completeCallback:()=>{M.toast({html:'<span>3) Receive donations!</span><i class="material-icons right white-text dismiss-toast">close</i>',classes:"green white-text",displayLength:5e3,outDuration:300})}})}})}()},700)}(),document.querySelector("#stripe-connect-btn a").addEventListener("click",function(){n("","blue"),setTimeout(()=>{chrome.runtime.sendMessage({message:"start_stripe_oauth"},n=>{n.error?"forbidden"==n.error.type?e():c():(t(),c())})},700)}),document.querySelector("#stripe-dashboard-btn a").addEventListener("click",function(){r("tipp_account").stripe&&(n("","blue"),setTimeout(()=>{chrome.runtime.sendMessage({message:"open_stripe_dashboard"},t=>{t.error&&"forbidden"==t.error.type?e():c()})},700))}),document.querySelector("#logout-btn a").addEventListener("click",e),document.querySelector("#yt-connect-btn a").addEventListener("click",function(){n("","red"),setTimeout(()=>{chrome.runtime.sendMessage({message:"start_youtube_connect_flow"},t=>{if(t.error)"forbidden"==t.error.type?e():c();else{const e=r("tipp_account");e.channels.length&&(o(e.channels[0].channelIcon,".user-view .profile-pic"),s(e.channels,"#yt-account")),c()}})},700)}),document.querySelector("#delete-account-btn").addEventListener("click",function(){n("","green"),setTimeout(()=>{chrome.runtime.sendMessage({message:"delete_user"},t=>{t.error?"forbidden"==t.error.type?e():c():(a("tipp_account",{}),window.location.replace(chrome.runtime.getURL("splash.html")))})},700)}),$(document).on("click",".dismiss-toast",function(e){M.Toast.getInstance(e.target.parentElement).dismiss()})}();
