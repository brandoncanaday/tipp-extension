!function(){const t="https://tippextension.com";function e(){let t=function(t,e){e||(e=window.location.href);t=t.replace(/[[\]]/g,"\\$&");let n=new RegExp("[#?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}("v");var e,r;e=t,r=(t=>{let e=function(t){let e=document.createElement("button"),i=document.createElement("img"),a=t.stripeId?function(){let t=document.createElement("form");t.className+=" tipp-form tipp-amount-form tipp-popup tipp-scale-transition tipp-scale-out",t.innerHTML+="<img src="+chrome.extension.getURL("img/tipp_brand.png")+' alt="tipp logo"/>',t.innerHTML+='<div class="tipp-input-field"><input type="text" id="tipp-amount" oninvalid="this.setCustomValidity(\'You must enter an amount.\')" oninput="this.setCustomValidity(\'\')" autocomplete="off" required><label for="tipp-amount">Enter Amount</label></div><button class="tipp-btn tipp-green tipp-hoverable" type="submit">Confirm</button>',t.addEventListener("click",t=>t.stopPropagation()),t.addEventListener("submit",n);let e=t.querySelector("#tipp-amount");return e.addEventListener("mousewheel",t=>t.preventDefault()),e.addEventListener("change",()=>{let t=e.parentNode.querySelector("label");e.value?t.classList.add("tipp-active"):t.classList.remove("tipp-active")}),t}():function(){const t=document.createElement("div");t.className+=" tipp-form tipp-popup tipp-call-to-action tipp-scale-transition tipp-scale-out";const e=document.createElement("img");e.src=chrome.extension.getURL("img/tipp_48x48.png");const n=document.createElement("p");n.textContent="This channel hasn't configured their Tipp account to receive donations yet.";const i=document.createElement("button");return i.className+=" tipp-btn tipp-green tipp-hoverable",i.textContent="Let them know",i.setAttribute("data-comment","Hey, so I just wanted to say that I'm a long-time fan, and I appreciate all the content you put out on a regular basis. Also, I just tried to donate to your video here, but in order for me to be able to do that, you have to install this Chrome extension called Tipp.\n\nIf you want more information, just visit their website, but it basically just allows people like me, who want to give a bit more than a Like, to make a donation on your video.\n\nIf you let your audience know they should download it, too, then they'll be able to start giving out donations where they see fit (as well as being able to receive donations themselves).\n\nAnyways, keep up the great work!"),i.addEventListener("click",t=>{const e=document.querySelector(".comment-simplebox-trigger");let n;(n=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(n);const i=document.querySelector(".comment-simplebox-text"),a=document.querySelector(".comment-simplebox-submit");i&&(i.textContent=t.target.getAttribute("data-comment")),a&&a.removeAttribute("disabled")}),t.appendChild(e),t.appendChild(n),t.appendChild(i),t.addEventListener("click",t=>t.stopPropagation()),t}(),o=function(){let t=document.createElement("div");return t.className+=" tipp-form tipp-popup tipp-login-prompt tipp-scale-transition tipp-scale-out",t.innerHTML+="<img src="+chrome.extension.getURL("img/tipp_48x48.png")+' alt="tipp logo"/>',t.innerHTML+="<p>You must be logged in to Tipp someone!</p>",t.addEventListener("click",t=>{t.stopPropagation()}),t}();return e.className+=" tipp-ext-btn",e.className+=" yt-uix-button-group",e.className+=" yt-uix-tooltip",e.setAttribute("data-tooltip-text","Tipp me"),e.setAttribute("data-destination",t.stripeId),e.setAttribute("data-fname",t.fname),e.setAttribute("data-lname",t.lname),e.setAttribute("data-displayname",t.displayname),e.addEventListener("click",()=>{s(e,a,o)}),i.setAttribute("src",chrome.extension.getURL("img/tipp-icon-btn.svg")),i.style.height="26px",i.style.width="26px",e.appendChild(i),e.appendChild(a),e.appendChild(o),e}(t),r=document.getElementById("watch8-action-buttons");r?p(r,e,!1):p(r=document.querySelector("#info.ytd-video-primary-info-renderer"),e,!0),t&&(document.querySelector("script[data-library=autonumeric]")||function(t,e,n){let i=document.createElement("script");i.src=t,i["data-label"]=e,i.onload=n,document.head.appendChild(i)}("https://cdn.jsdelivr.net/npm/autonumeric@4.1.0-beta.16/dist/autoNumeric.min.js","autonumeric",()=>{i(o,"autonumeric-initializer")})),t&&(document.querySelector("script[data-label=stripeCheckoutIntercept]")||i(a,"stripeCheckoutIntercept"))}),chrome.runtime.sendMessage({message:"get_stripe_user_from_YT_video",video:e},t=>{r(t)})}function n(e){e.preventDefault();const n=document.querySelector(".tipp-ext-btn"),i=e.target.querySelector("#tipp-amount"),a=i.parentNode.querySelector("label"),o=e.target.querySelector("button[type=submit]"),s=function(t){let e=+t.replace(/[^0-9.]+/g,"");return isNaN(e)?void 0:e}(i.value);if(!s||s<1)i.classList.add("tipp-invalid"),a.textContent="Enter Tipp Amount ($1.00 minimum)";else{const p=100*s,r=(n.getAttribute("data-fname"),n.getAttribute("data-lname"),function(e,n,i,a){const o={"data-key":"pk_test_Ico77z8GgHKmrINbf9VnxIRY","data-name":"Tipp","data-image":"https://image.ibb.co/kF2Apm/tipp_128x128.png","data-description":`A Tipp for @${a}`,"data-panel-label":"Tipp {{amount}}","data-label":"Tipp with Card","data-locale":"auto","data-zip-code":!0,"data-billing-address":!0,"data-bitcoin":!0};let s=document.createElement("form"),p=document.createElement("script");s.className="tipp-stripe-payment-form",s.setAttribute("action",`${t}/api/dummy`),s.setAttribute("method","GET"),p.src="https://checkout.stripe.com/checkout.js",p.className="stripe-button",p.setAttribute("data-amount",e);for(let t in o)o.hasOwnProperty(t)&&p.setAttribute(t,o[t]);return s.appendChild(p),s}(p,0,0,n.getAttribute("data-displayname")));i.style.display="none",a.style.display="none",o.style.display="none",e.target.appendChild(r)}}function i(t,e){let n=document.createElement("script");n[n.innerText?"innerText":"textContent"]="("+t+")()",n["data-label"]=e,document.head.appendChild(n)}function a(){window.addEventListener("beforeunload",()=>{let t=null,e=document.querySelector("input[name=stripeToken]");e&&(t={},e.parentNode.querySelectorAll("input[type=hidden]").forEach(e=>{t[e.getAttribute("name")]=e.value,e.parentNode.removeChild(e)})),t&&window.postMessage({message:"STRIPE_CARD_TOKENIZED",token:t},"*")})}function o(){window.tippAmountInput=new AutoNumeric("#tipp-amount").northAmerican({minimumValue:1})}function s(t,e,n){t.classList.toggle("yt-uix-tooltip"),document.querySelectorAll(".yt-uix-tooltip-tip").forEach(t=>{"Tipp me"==t.querySelector(".yt-uix-tooltip-tip-content").textContent&&(t.style.display="none")}),e.classList.contains("tipp-scale-in")?(e.classList.remove("tipp-scale-in"),t.setAttribute("data-tooltip-text","Tipp me"),e.classList.contains("tipp-call-to-action")||setTimeout(()=>(function(t){let e=t.querySelector(".tipp-stripe-payment-form"),n=t.querySelector("button[type=submit]"),i=t.querySelector("#tipp-amount"),a=i.parentNode.querySelector("label");i.value="",a.classList.remove("tipp-active"),i.classList.remove("tipp-invalid"),a.textContent="Enter Amount",i.style.display="inline-block",a.style.display="inline-block",n.style.display="inline-block",e&&t.removeChild(e)})(e),200)):n.classList.contains("tipp-scale-in")?(n.classList.remove("tipp-scale-in"),t.setAttribute("data-tooltip-text","Tipp me")):(t.setAttribute("data-tooltip-text",""),t.setAttribute("title",""),chrome.runtime.sendMessage({message:"is_logged_in"},t=>{t.loggedIn?e.classList.add("tipp-scale-in"):n.classList.add("tipp-scale-in")}))}function p(t,e,n){const i=t.querySelector(".tipp-ext-btn");if(i&&i.parentNode.removeChild(i),n){let n=t.querySelector("#flex");n.parentNode.insertBefore(e,n.nextSibling),t.addEventListener("mouseenter",()=>{e.classList.add("pulse")}),t.addEventListener("mouseleave",()=>{e.classList.remove("pulse")})}else t.appendChild(e),t.addEventListener("mouseenter",()=>{e.classList.add("pulse")}),t.addEventListener("mouseleave",()=>{e.classList.remove("pulse")})}window.addEventListener("yt-navigate-finish",()=>{"/watch"==window.location.pathname&&e()}),window.addEventListener("spfdone",()=>{"/watch"==window.location.pathname&&e()}),window.addEventListener("message",t=>{"/watch"==window.location.pathname&&function(t){if(t.source==window&&t.data.message&&"STRIPE_CARD_TOKENIZED"==t.data.message&&t.data.token.stripeToken){const e=document.querySelector(".tipp-ext-btn"),n=e.querySelector(".tipp-popup"),i=e.querySelector(".tipp-login-prompt"),a=document.querySelector("script.stripe-button").getAttribute("data-amount"),o=e.getAttribute("data-destination"),p=e.getAttribute("data-fname"),r=e.getAttribute("data-lname"),l=e.getAttribute("data-displayname");s(e,n,i),chrome.runtime.sendMessage({message:"perform_tipp",data:{token:t.data.token,amount:a,destination:o,fname:p,lname:r,displayname:l}})}}(t)},!1),"/watch"==window.location.pathname&&e()}();
