!function(){const t="https://tippextension.com";function e(){let t=function(t,e){e||(e=window.location.href);t=t.replace(/[[\]]/g,"\\$&");let n=new RegExp("[#?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}("v");var e,l;e=t,l=(t=>{let e=function(t){let e=document.createElement("button"),o=document.createElement("img"),a=t.stripeId?function(){let t=document.createElement("form");t.className+=" tipp-form tipp-amount-form tipp-popup tipp-scale-transition tipp-scale-out",t.innerHTML+="<img src="+chrome.extension.getURL("img/tipp_brand.png")+' alt="tipp logo"/>',t.innerHTML+='<div class="tipp-input-field"><input type="text" id="tipp-amount" oninvalid="this.setCustomValidity(\'You must enter an amount.\')" oninput="this.setCustomValidity(\'\')" autocomplete="off" required><label for="tipp-amount">Enter Amount</label></div><button class="tipp-btn tipp-green tipp-hoverable" type="submit">Confirm</button>',t.addEventListener("click",t=>t.stopPropagation()),t.addEventListener("submit",n);let e=t.querySelector("#tipp-amount");return e.addEventListener("mousewheel",t=>t.preventDefault()),e.addEventListener("change",()=>{let t=e.parentNode.querySelector("label");e.value?t.classList.add("tipp-active"):t.classList.remove("tipp-active")}),t}():function(){const t=document.createElement("div");t.className+=" tipp-form tipp-popup tipp-call-to-action tipp-scale-transition tipp-scale-out";const e=document.createElement("img");e.src=chrome.extension.getURL("img/tipp_48x48.png");const n=document.createElement("p");n.textContent="This channel hasn't configured their Tipp account to receive donations yet.";const o=document.createElement("button");return o.className+=" tipp-btn tipp-green tipp-hoverable",o.textContent="Let them know",o.setAttribute("data-comment","Hey, so I just wanted to say that I'm a long-time fan, and I appreciate all the content you put out on a regular basis. I was thinking about making a one-time donation to your video here, but in order for me to be able to do that, you have to install this Chrome extension called Tipp.\n\nIf you want more information, just visit the website, but the TLDR; version is that it allows people like me, who want to give a bit more than a Like, to make donations on your videos.\n\nIf you let your audience know they should download it as well, then they'll be able to start giving out donations where they see fit (as well as being able to receive donations themselves).\n\nAnyways, keep up the great work!"),o.addEventListener("click",i),t.appendChild(e),t.appendChild(n),t.appendChild(o),t.addEventListener("click",t=>t.stopPropagation()),t}(),r=function(){let t=document.createElement("div");return t.className+=" tipp-form tipp-popup tipp-login-prompt tipp-scale-transition tipp-scale-out",t.innerHTML+="<img src="+chrome.extension.getURL("img/tipp_48x48.png")+' alt="tipp logo"/>',t.innerHTML+="<p>You must be logged in to Tipp someone!</p>",t.addEventListener("click",t=>{t.stopPropagation()}),t}();return e.className+=" tipp-ext-btn",e.className+=" yt-uix-button-group",e.className+=" yt-uix-tooltip",e.setAttribute("data-tooltip-text","Tipp me"),e.setAttribute("data-destination",t.stripeId),e.setAttribute("data-fname",t.fname),e.setAttribute("data-lname",t.lname),e.setAttribute("data-displayname",t.displayname),e.addEventListener("click",()=>{s(e,a,r)}),o.setAttribute("src",chrome.extension.getURL("img/tipp-icon-btn.svg")),o.style.height="26px",o.style.width="26px",e.appendChild(o),e.appendChild(a),e.appendChild(r),e}(t),l=document.getElementById("watch8-action-buttons");l?p(l,e,!1):p(l=document.querySelector("#info.ytd-video-primary-info-renderer"),e,!0),t&&(document.querySelector("script[data-library=autonumeric]")||function(t,e,n){let i=document.createElement("script");i.src=t,i["data-label"]=e,i.onload=n,document.head.appendChild(i)}("https://cdn.jsdelivr.net/npm/autonumeric@4.1.0-beta.16/dist/autoNumeric.min.js","autonumeric",()=>{o(r,"autonumeric-initializer")})),t&&(document.querySelector("script[data-label=stripeCheckoutIntercept]")||o(a,"stripeCheckoutIntercept"))}),chrome.runtime.sendMessage({message:"get_stripe_user_from_YT_video",video:e},t=>{l(t)})}function n(e){e.preventDefault();const n=document.querySelector(".tipp-ext-btn"),i=e.target.querySelector("#tipp-amount"),o=i.parentNode.querySelector("label"),a=e.target.querySelector("button[type=submit]"),r=function(t){let e=+t.replace(/[^0-9.]+/g,"");return isNaN(e)?void 0:e}(i.value);if(!r||r<1)i.classList.add("tipp-invalid"),o.textContent="Enter Tipp Amount ($1.00 minimum)";else{const s=100*r,p=(n.getAttribute("data-fname"),n.getAttribute("data-lname"),function(e,n,i,o){const a={"data-key":"pk_test_Ico77z8GgHKmrINbf9VnxIRY","data-name":"Tipp","data-image":"https://image.ibb.co/kF2Apm/tipp_128x128.png","data-description":`A Tipp for @${o}`,"data-panel-label":"Tipp {{amount}}","data-label":"Tipp with Card","data-locale":"auto","data-zip-code":!0,"data-billing-address":!0,"data-bitcoin":!0};let r=document.createElement("form"),s=document.createElement("script");r.className="tipp-stripe-payment-form",r.setAttribute("action",`${t}/api/dummy`),r.setAttribute("method","GET"),s.src="https://checkout.stripe.com/checkout.js",s.className="stripe-button",s.setAttribute("data-amount",e);for(let t in a)a.hasOwnProperty(t)&&s.setAttribute(t,a[t]);return r.appendChild(s),r}(s,0,0,n.getAttribute("data-displayname")));i.style.display="none",o.style.display="none",a.style.display="none",e.target.appendChild(p)}}function i(t){let e=document.querySelector(".comment-simplebox-trigger");if(e){let n;(n=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(n);const i=document.querySelector(".comment-simplebox-text"),o=document.querySelector(".comment-simplebox-submit");i&&(i.textContent=t.target.getAttribute("data-comment")),o&&o.removeAttribute("disabled")}else{let n;e=document.querySelector("#placeholder-area.ytd-comment-simplebox-renderer"),(n=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(n);const i=document.querySelector("#textarea.ytd-commentbox textarea#textarea"),o=document.querySelector("#mirror.mirror-text.iron-autogrow-textarea"),a=document.querySelector("#buttons.ytd-commentbox #submit-button #button");i&&(i.textContent=t.target.getAttribute("data-comment")),o&&(o.innerHTML=t.target.getAttribute("data-comment")+"&nbsp;"),a&&a.removeAttribute("disabled")}}function o(t,e){let n=document.createElement("script");n[n.innerText?"innerText":"textContent"]="("+t+")()",n["data-label"]=e,document.head.appendChild(n)}function a(){window.addEventListener("beforeunload",()=>{let t=null,e=document.querySelector("input[name=stripeToken]");e&&(t={},e.parentNode.querySelectorAll("input[type=hidden]").forEach(e=>{t[e.getAttribute("name")]=e.value,e.parentNode.removeChild(e)})),t&&window.postMessage({message:"STRIPE_CARD_TOKENIZED",token:t},"*")})}function r(){window.tippAmountInput=new AutoNumeric("#tipp-amount").northAmerican({minimumValue:1})}function s(t,e,n){t.classList.toggle("yt-uix-tooltip"),document.querySelectorAll(".yt-uix-tooltip-tip").forEach(t=>{"Tipp me"==t.querySelector(".yt-uix-tooltip-tip-content").textContent&&(t.style.display="none")}),e.classList.contains("tipp-scale-in")?(e.classList.remove("tipp-scale-in"),t.setAttribute("data-tooltip-text","Tipp me"),e.classList.contains("tipp-call-to-action")||setTimeout(()=>(function(t){let e=t.querySelector(".tipp-stripe-payment-form"),n=t.querySelector("button[type=submit]"),i=t.querySelector("#tipp-amount"),o=i.parentNode.querySelector("label");i.value="",o.classList.remove("tipp-active"),i.classList.remove("tipp-invalid"),o.textContent="Enter Amount",i.style.display="inline-block",o.style.display="inline-block",n.style.display="inline-block",e&&t.removeChild(e)})(e),200)):n.classList.contains("tipp-scale-in")?(n.classList.remove("tipp-scale-in"),t.setAttribute("data-tooltip-text","Tipp me")):(t.setAttribute("data-tooltip-text",""),t.setAttribute("title",""),chrome.runtime.sendMessage({message:"is_logged_in"},t=>{t.loggedIn?e.classList.add("tipp-scale-in"):n.classList.add("tipp-scale-in")}))}function p(t,e,n){const i=t.querySelector(".tipp-ext-btn");if(i&&i.parentNode.removeChild(i),n){let n=t.querySelector("#flex");n.parentNode.insertBefore(e,n.nextSibling),t.addEventListener("mouseenter",()=>{e.classList.add("pulse")}),t.addEventListener("mouseleave",()=>{e.classList.remove("pulse")})}else t.appendChild(e),t.addEventListener("mouseenter",()=>{e.classList.add("pulse")}),t.addEventListener("mouseleave",()=>{e.classList.remove("pulse")})}window.addEventListener("yt-navigate-finish",()=>{"/watch"==window.location.pathname&&e()}),window.addEventListener("spfdone",()=>{"/watch"==window.location.pathname&&e()}),window.addEventListener("message",t=>{"/watch"==window.location.pathname&&function(t){if(t.source==window&&t.data.message&&"STRIPE_CARD_TOKENIZED"==t.data.message&&t.data.token.stripeToken){const e=document.querySelector(".tipp-ext-btn"),n=e.querySelector(".tipp-popup"),i=e.querySelector(".tipp-login-prompt"),o=document.querySelector("script.stripe-button").getAttribute("data-amount"),a=e.getAttribute("data-destination"),r=e.getAttribute("data-fname"),p=e.getAttribute("data-lname"),l=e.getAttribute("data-displayname");s(e,n,i),chrome.runtime.sendMessage({message:"perform_tipp",data:{token:t.data.token,amount:o,destination:a,fname:r,lname:p,displayname:l}})}}(t)},!1),"/watch"==window.location.pathname&&e()}();
