!function(){function e(e,t,s,r,a,i,n){const p={};return e?(p.type="user_exists",p.msg="Displayname already in use.",p):t&&s&&r&&a&&i&&n?i.length<15?(p.type="passphrase",p.msg="For your security, passphrase must be at least 15 characters.",p):i!=n?(p.type="passphrase_repeat",p.msg="Re-typed passphrase does not match.",p):p:(p.type="missing_field",p.msg="All fields are required.",p)}function t(e,t){const s=$("<p></p>");s.addClass("validation-error"),s.text(t.msg),s.insertAfter(`${e} > *:last-child`)}function s(e){$(e).length&&$(e).find(".validation-error").remove()}function r(e,t){let s=document.querySelector(".tipp-preloader-modal"),r=s.querySelector(".spinner-layer");switch(document.querySelector(".tipp-preloader-modal .header").textContent=e,r.classList.remove("spinner-blue-only"),r.classList.remove("spinner-red-only"),r.classList.remove("spinner-green-only"),t){case"blue":r.classList.add("spinner-blue-only");break;case"red":r.classList.add("spinner-red-only");break;case"green":default:r.classList.add("spinner-green-only")}s.style.display="block"}function a(){document.querySelector(".tipp-preloader-modal").style.display="none"}$(".modal").modal(),document.querySelector("#tipp-register .form-page-1").addEventListener("submit",function(i){i.preventDefault(),s("#tipp-register .basic-information-fields");const n=$("#tipp-fname").val(),p=$("#tipp-lname").val(),l=$("#tipp-displayname").val(),o=function(e,t,s){const r={};if(!e||!t||!s)return r.type="missing_field",r.msg="All fields are required.",r;return r}(n,p,l);o.type?t("#tipp-register .basic-information-fields",o):(i.target.querySelector("button[type=submit]").disabled=!0,r("","green"),chrome.runtime.sendMessage({message:"displayname_availability",data:{displayname:l}},s=>{setTimeout(()=>{s.error?(t("#tipp-register .basic-information-fields",s.error),a()):s.exists?(t("#tipp-register .basic-information-fields",e(s.exists)),a()):(!function(){const e=$("#tipp-register .form-page-1"),t=$("#tipp-register .form-page-2");e.css({"-webkit-transform":"translateX(-200%)","-ms-transform":"translateX(-200%)",transform:"translateX(-200%)"}),e.css("visibility","hidden"),t.css("visibility","visible"),t.css({"-webkit-transform":"translateX(0)","-ms-transform":"translateX(0)",transform:"translateX(0)"})}(),a()),i.target.querySelector("button[type=submit]").disabled=!1},700)}));return!1}),document.querySelector("#tipp-register .form-page-2").addEventListener("submit",function(i){i.preventDefault(),s("#tipp-register .login-information-fields");const n=$("#tipp-fname").val(),p=$("#tipp-lname").val(),l=$("#tipp-displayname").val(),o=$("#tipp-email").val(),m=$("#tipp-passphrase").val(),d=$("#tipp-passphrase-repeat").val(),u=e(!1,n,p,l,o,m,d);u.type?t("#tipp-register .login-information-fields",u):(i.target.querySelector("button[type=submit]").disabled=!0,r("","green"),chrome.runtime.sendMessage({message:"create_user",data:{fname:n,lname:p,displayname:l,email:o,passphrase:m}},e=>{setTimeout(()=>{e.error?(t("#tipp-register .login-information-fields",e.error),a()):window.location.replace(chrome.runtime.getURL("dashboard.html")),i.target.querySelector("button[type=submit]").disabled=!1},700)}));return!1}),document.querySelector("#back-btn").addEventListener("click",function(){const e=$("#tipp-register .form-page-1"),t=$("#tipp-register .form-page-2");e.css("visibility","visible"),e.css({"-webkit-transform":"translateX(0)","-ms-transform":"translateX(0)",transform:"translateX(0)"}),t.css({"-webkit-transform":"translateX(200%)","-ms-transform":"translateX(200%)",transform:"translateX(200%)"}),t.css("visibility","hidden")}),document.querySelector("#tipp-login").addEventListener("submit",function(e){e.preventDefault(),s("#tipp-login .field-group");const i=$("#tipp-login-email").val(),n=$("#tipp-login-passphrase").val(),p=function(e,t){const s={};if(!e||!t)return s.type="missing_field",s.msg="Both fields are required.",s;if(t.length<15)return s.type="passphrase",s.msg="Passphrase should be at least 15 characters, think harder.",s;return s}(i,n);p.type?t("#tipp-login .field-group",p):(e.target.querySelector("button[type=submit]").disabled=!0,r("","green"),chrome.runtime.sendMessage({message:"login_user",email:i,passphrase:n},s=>{setTimeout(()=>{s.error?(t("#tipp-login .field-group",s.error),a()):window.location.replace(chrome.runtime.getURL("dashboard.html")),e.target.querySelector("button[type=submit]").disabled=!1},700)}));return!1}),document.querySelector("#tipp-passphrase-reset").addEventListener("submit",function(e){e.preventDefault(),s("#tipp-passphrase-reset");const i=$("#passphrase-reset-email").val(),n=$("#passphrase-reset-email-repeat").val(),p=function(e,t){const s={};if(!e||!t)return s.type="missing_field",s.msg="Both fields are required.",s;if(e!=t)return s.type="email_repeat",s.msg="Re-typed email does not match.",s;return s}(i,n);p.type?t("#tipp-passphrase-reset",p):(document.querySelector("#passphrase-reset-modal button[type=submit]").disabled=!0,r("","green"),chrome.runtime.sendMessage({message:"reset_passphrase",email:i},e=>{setTimeout(()=>{e.error?(t("#tipp-passphrase-reset",e.error),a()):(a(),$("#passphrase-reset-modal").modal("close"),$("#passphrase-reset-email").val(""),$("#passphrase-reset-email-repeat").val("")),document.querySelector("#passphrase-reset-modal button[type=submit]").disabled=!1},700)}));return!1})}();
