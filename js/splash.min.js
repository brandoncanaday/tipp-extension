!function(){function e(e,t,r,s,a,i,n){const p={};return e?(p.type="user_exists",p.msg="Displayname already in use.",p):t&&r&&s&&a&&i&&n?i.length<15?(p.type="passphrase",p.msg="For your security, passphrase must be at least 15 characters.",p):i!=n?(p.type="passphrase_repeat",p.msg="Re-typed passphrase does not match.",p):p:(p.type="missing_field",p.msg="All fields are required.",p)}function t(e,t){const r=$("<p></p>");r.addClass("validation-error"),r.text(t.msg),r.insertAfter(`${e} > *:last-child`)}function r(e){$(e).length&&$(e).find(".validation-error").remove()}function s(e,t){let r=document.querySelector(".tipp-preloader-modal"),s=r.querySelector(".spinner-layer");switch(document.querySelector(".tipp-preloader-modal .header").textContent=e,s.classList.remove("spinner-blue-only"),s.classList.remove("spinner-red-only"),s.classList.remove("spinner-green-only"),t){case"blue":s.classList.add("spinner-blue-only");break;case"red":s.classList.add("spinner-red-only");break;case"green":default:s.classList.add("spinner-green-only")}r.style.display="block"}function a(){document.querySelector(".tipp-preloader-modal").style.display="none"}$(".modal").modal(),document.querySelector("#tipp-register .form-page-1").addEventListener("submit",function(i){i.preventDefault(),r("#tipp-register .basic-information-fields");const n=$("#tipp-fname").val(),p=$("#tipp-lname").val(),o=$("#tipp-displayname").val(),l=function(e,t,r){const s={};if(!e||!t||!r)return s.type="missing_field",s.msg="All fields are required.",s;return s}(n,p,o);l.type?t("#tipp-register .basic-information-fields",l):(i.target.querySelector("button[type=submit]").disabled=!0,s("","green"),chrome.runtime.sendMessage({message:"displayname_availability",data:{displayname:o}},r=>{setTimeout(()=>{r.error?(t("#tipp-register .basic-information-fields",r.error),a()):r.exists?(t("#tipp-register .basic-information-fields",e(r.exists)),a()):(!function(){const e=$("#tipp-register .form-page-1"),t=$("#tipp-register .form-page-2");e.css({"-webkit-transform":"translateX(-200%)","-ms-transform":"translateX(-200%)",transform:"translateX(-200%)"}),e.css("visibility","hidden"),t.css("visibility","visible"),t.css({"-webkit-transform":"translateX(0)","-ms-transform":"translateX(0)",transform:"translateX(0)"})}(),a()),i.target.querySelector("button[type=submit]").disabled=!1},700)}));return!1}),document.querySelector("#tipp-register .form-page-2").addEventListener("submit",function(i){i.preventDefault(),r("#tipp-register .login-information-fields");const n=$("#tipp-fname").val(),p=$("#tipp-lname").val(),o=$("#tipp-displayname").val(),l=$("#tipp-email").val(),m=$("#tipp-passphrase").val(),d=$("#tipp-passphrase-repeat").val(),u=e(!1,n,p,o,l,m,d);u.type?t("#tipp-register .login-information-fields",u):(i.target.querySelector("button[type=submit]").disabled=!0,s("","green"),chrome.runtime.sendMessage({message:"create_user",data:{fname:n,lname:p,displayname:o,email:l,passphrase:m}},e=>{setTimeout(()=>{e.error?(t("#tipp-register .login-information-fields",e.error),a()):window.location.replace(chrome.runtime.getURL("dashboard.html")),i.target.querySelector("button[type=submit]").disabled=!1},700)}));return!1}),document.querySelector("#back-btn").addEventListener("click",function(){const e=$("#tipp-register .form-page-1"),t=$("#tipp-register .form-page-2");e.css("visibility","visible"),e.css({"-webkit-transform":"translateX(0)","-ms-transform":"translateX(0)",transform:"translateX(0)"}),t.css({"-webkit-transform":"translateX(200%)","-ms-transform":"translateX(200%)",transform:"translateX(200%)"}),t.css("visibility","hidden")}),document.querySelector("#tipp-login").addEventListener("submit",function(e){e.preventDefault(),r("#tipp-login .field-group");const i=$("#tipp-login-email").val(),n=$("#tipp-login-passphrase").val(),p=function(e,t){const r={};if(!e||!t)return r.type="missing_field",r.msg="Both fields are required.",r;if(t.length<15)return r.type="passphrase",r.msg="Passphrase should be at least 15 characters, think harder.",r;return r}(i,n);p.type?t("#tipp-login .field-group",p):(e.target.querySelector("button[type=submit]").disabled=!0,s("","green"),chrome.runtime.sendMessage({message:"login_user",email:i,passphrase:n},r=>{setTimeout(()=>{r.error?(t("#tipp-login .field-group",r.error),a()):window.location.replace(chrome.runtime.getURL("dashboard.html")),e.target.querySelector("button[type=submit]").disabled=!1},700)}));return!1}),document.querySelector("#tipp-passphrase-reset").addEventListener("submit",function(e){e.preventDefault(),r("#tipp-passphrase-reset .field-group");const i=$("#passphrase-reset-email").val(),n=$("#passphrase-reset-email-repeat").val(),p=function(e,t){const r={};if(!e||!t)return r.type="missing_field",r.msg="Both fields are required.",r;if(e!=t)return r.type="email_repeat",r.msg="Re-typed email does not match.",r;return r}(i,n);p.type?t("#tipp-passphrase-reset .field-group",p):(document.querySelector("#passphrase-reset-modal button[type=submit]").disabled=!0,s("","green"),chrome.runtime.sendMessage({message:"reset_passphrase",email:i},e=>{setTimeout(()=>{e.error?(t("#tipp-passphrase-reset .field-group",e.error),a()):(a(),$("#passphrase-reset-modal").modal("close")),document.querySelector("#passphrase-reset-modal button[type=submit]").disabled=!1},700)}));return!1})}();
